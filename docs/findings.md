# Findings

Findings are the relation of an _issue_ present in a _target_.

They are the main "citizen" of the Vulnerability DB and the one that provides more information about the relation of an _issue_, the _target_ on which that issue was found, and the _source_ from which it was detected and reported.

**Regarding the _source_** information for a _finding_, we have to make clear that, for the Vulnerability DB, a _finding_ is primarely the relation of an _issue_ for a _target_, regardless of which source detected it.
It's important to understand that, therefore, a _finding_ can have been found multiple times, maybe by the same type of _source_, or maybe by different ones. So there is not a clear 1:1 relation between a _finding_ and a _source_.
Now you might be wondering why, when querying the API for findings, we get information for one _source_ associated for each finding. The reason for this is that we made a decision to, when requesting information related to _findings_ to the API, return only the data for the last source that reported that _finding_.

Finding endpoints also provide other data like the **_total\_exposure_** and **_current\_exposure_**.
The _total_exposure_ is the total amount of time (hours) that the _issue_ has been open for that _target_. If the _issue_ has been through numerous cycles of _OPEN_ -> _FIXED_ -> _OPEN_ -> _FIXED_, then the _total\_exposure_ is the sum of days for the periods of time on which the _finding_ had a status of _OPEN_. If the _finding_ is still _OPEN_ at the time of the request, _total\_exposure_ includes the hours since the last _OPEN_ event for the _finding_ up until the time of the request.
The _current\_exposure_, which only applies for _findings_ that are currently _OPEN_, is the number of hours that the _finding_ has been _OPEN_ since the last time it was detected, or, if it has not been through cycles of _OPEN_ -> _FIXED_, the time since it was first discovered.

Another **important thing to mention regarding _target_** information for a _finding_ is the _tags_ list. Vulnerability DB allows to associate a list of _tags_ for each _target_. These _tags_ can be used afterwards when querying the API. For example we can query only the _findings_ that are associated with _targets_ that have a specific _tag_.

## Querying the API for findings

The Vulnerability Database API provides different methods to query information about the findings currently present in the system.

### List Findings
List findings endpoint allows to query all the findings currently present in the Vulnerability Database.
```
curl -H "Content-Type: application/json" \
"https://vulnerabilitydb.vulcan.com/findings"
```

This endpoint has support for many query string filter parameters, including filters for _score_, _status_, _date_, _tags_, etc. You can see the whole list of options in the [API Reference](swagger/) section.

It's important though, to give a clear **explanaiton about how the _date_ filter** options work.
The endpoint has support for three date related filters:
- _minDate_: Specifies the minimum date to query for.
- _maxDate_: Specifies the maximum date to query for.
- _atDate_: Specifies the exact moment in time to query for.

Obviously _atDate_ parameter is incompatible with the other two.

At the same time it's important to note that **date ranges filters MUST** be used along with the **_status_** filter. 
It does not make sense to query for the _findings_ between _dateA_ and _dateB_. It makes sense to query for the _findings_ that have been _OPEN_/_FIXED_ between _dateA_ and _dateB_.

We also have to clarify the behavior when performing queries for date ranges:
- When querying for _OPEN_ _findings_ in a specific time range, the endpoint returns every _finding_ that has been found in that time range, **regardless if that _finding_ has also been _FIXED_ in that span of time**.
- When querying for _FIXED_ _findings_ in a specific time range, the endpoint returns every _finding_ that has been _FIXED_ in that time **and is also _FIXED_ at the end of that time span**. So a _finding_ that has been _FIXED_, then _OPEN_ and then _FIXED_ withing that time range, will be returned. But a _finding_ that has been _FIXED_ and then _OPEN_ and is still _OPEN_ at the end of that time range, will not be returned.

With the **_atDate_** parameter we can retrieve the list of _findings_ with their data and status correspondent to the specified date. That means that _total\_exposure_ and _current\_exposure_ fields are recalculated up until the time specified in the _atDate_ parameter.

For example we could query for all the high and critical severity _findings_ that were _FIXED_ during Q4 of 2019:
```
curl -H "Content-Type: application/json" \
"https://vulnerabilitydb.vulcan.com/findings?minDate=2019-10-01&maxDate=2019-12-31&status=FIXED&minScore=7"
```

Or we could query for all the _findings_ that were _OPEN_ at the beginning of Q1 2020 for _targets_ that are associated with the Security Team:
```
curl -H "Content-Type: application/json" \
"https://vulnerabilitydb.vulcan.com/findings?atDate=2020-01-01&status=OPEN&tag=sdrn:adevinta:team:security"
```

### Get Finding
The Get Finding endpoint allows to query information related with a particular finding, specifying its ID.
```
curl -H "Content-Type: application/json" \
"https://vulnerabilitydb.vulcan.com/findings/0205a902-64a7-4c77-8d00-5d4c8d06399a"
```

### List Events by Finding
As we said, a _finding_ can be reported many times by different sources, each one of these _FOUND_ events is a _finding\_event_.

We can list all the events for a specific finding:
```
curl -H "Content-Type: application/json" \
"https://vulnerabilitydb.vulcan.com/findings/afd5234d-dceb-4c8b-93f2-4ec0eae5a35d/events"
```

### Finding MTTR
MTTR stands for _Mean_ _Time_ _To_ _Remediate_, and is the average time that elapses since the vulnerability is found until it is fixed.

As we said, a vulnerability can go through different states during its lifecycle. For example it can be _OPEN_, then _FIXED_, then _OPEN_ again, and finally _FIXED_ for the same _target_. In this case the _finding_ _MTTR_ would be the average time (days) on which it had the status of _OPEN_.

This endpoint allows to query that average time specifically for one particular _finding_.
```
curl -H "Content-Type: application/json" \
"https://vulnerabilitydb.vulcan.com/issues/20289f5d-8c6e-40e7-81a3-b3e2e0f7fbe5/mttr"
```
